<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>-21000</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>
fading=1;fade_alpha=0;textt="";
time_min=0;lines_acted=0;liness=0;
time_at=0;time_min=0;time_max=100;
part2="";part3="";
exit_fade=-1;closing=false;


attendants=0;avatars=0;
var i;i=-1;
repeat(2501){i+=1;
    attend_co[i]=0;attend_id[i]=0;attend_mood[i]="";attend_corrupted[i]=0;
    attend_feasted[i]=0;attend_drunk[i]=0;attend_high[i]=0;attend_confused[i]=0;attend_actioned[i]=0;
    attend_corruption[i]=0;attend_race[i]=0;attend_displayed[i]=0;// Set to 1
    
    if (i&lt;=10){
        avatar_name[i]="";
        avatar_rank[i]="";
        avatar_image[i]=0;
        avatar_co[i]=0;
        avatar_id[i]=0;
    }
    if (i&lt;=20){
        line[i]="";
    }
}
lines=0;


main_color=obj_ini.main_color;
secondary_color=obj_ini.secondary_color;
trim_color=obj_ini.trim_color;
pauldron2_color=obj_ini.pauldron2_color;
pauldron_color=obj_ini.pauldron_color;
lens_color=obj_ini.lens_color;
weapon_color=obj_ini.weapon_color;
col_special=obj_ini.col_special;
trim=obj_ini.trim;

stage=5;ticks=-120;ticked=0;
next_display=90;total_displayed=0;

scr_colors_initialize();
scr_shader_initialize();


if (obj_controller.fest_display&gt;0){var q,yep;q=0;yep=0;
    if (obj_ini.artifact_tags[obj_controller.fest_display]!=obj_controller.fest_display_tags){
        repeat(20){q+=1;if (yep=0){if (obj_ini.artifact_tags[q]=obj_controller.fest_display_tags) then yep=q;}}
        if (yep&gt;0) then obj_controller.fest_display=q;
        if (yep=0) then obj_controller.fest_display=0;
    }
}


</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>
var intro;intro="";

if (obj_controller.fest_type="Great Feast"){
    if (obj_controller.fest_feasts=0) then obj_controller.fest_feasts+=1;
    
    if (obj_controller.fest_lav&lt;4) then intro="Once all are seated "+string(obj_img.player_army)+" Serfs begin to ferry the covered main dish";
    if (obj_controller.fest_lav&gt;=4) then intro="Once all are seated "+string(obj_img.player_army)+" Serfs begin to ferry the first of several dishes";
    
    if (obj_controller.fest_feature2=1) and (obj_controller.fest_feature3=0) then intro+=" and alcohol";
    if (obj_controller.fest_feature2=0) and (obj_controller.fest_feature3=1) then intro+=" and drugs";
    if (obj_controller.fest_feature2=1) and (obj_controller.fest_feature3=1) then intro+=", booze, and drugs";
    
    intro+=" into the room.  This is ";
    
    if (obj_controller.fest_feature2+obj_controller.fest_feature3&gt;0) then intro+="all ";
    intro+="placed front and center.  A silver cloche is then removed, revealing ";
    
    if (obj_controller.fest_lav&lt;=1){
        if (attendants&lt;=50) then intro+="a large vat of stew, made up of Triglyceride Gel and grox meat.";
        if (attendants&gt;50) then intro+="several large vats of stew, made up of Triglyceride Gel and grox meat.";
    }
    if (obj_controller.fest_lav=2){
        if (attendants&lt;=50) then intro+="an entire roast Grox, finely seasoned and flavored.  Vegtables lay around the belly and feet of the beast.";
        if (attendants&gt;50) then intro+="several roast Grox, each finely seasoned and flavored.  Vegtables lay around the bellies and feet of the beasts.";
    }
    if (obj_controller.fest_lav=3){
        if (attendants&lt;=105) then intro+="a massive, roasted Borreron Terrorwing, maronated in Dammassine and filled with stuffing.";
        if (attendants&gt;105) then intro+="a pair of roasted Borreron Terrorwings, each maronated in Dammassine and filled with stuffing.";
    }
    if (obj_controller.fest_lav=4){
        intro+="cheese and wine Hors d'oeuvre and pasties, the small, bite-size edibles decorated with a flourish.";
        part2="fish";
    }
    if (obj_controller.fest_lav&gt;=5){
        if (attendants&lt;=50) then intro+="a large plater of mediterranean Grox salad, with nuts and sliced pears.";
        if (attendants&gt;50) then intro+="several platers of mediterranean Grox salad, with nuts and sliced pears.";
        part2="fruit";part3="lobster";
    }
    
    
    if (obj_controller.fest_feature2=1){
        var boozer_type;boozer_type=1;
        if (global.chapter_name="Space Wolves") or (obj_ini.progenitor=3) then boozer_type=2;
        if (global.chapter_name="Blood Angels") or (obj_ini.progenitor=5) then boozer_type=3;
        
        if (boozer_type=1) then intro+="  Also provided is well-aged, finely distilled Amasec.";
        if (boozer_type=2) and (global.chapter_name!="Space Wolves") then intro+="  Also provided is Fenrir-imported Mjod, favored by the sons of Russ.";
        if (boozer_type=2) and (global.chapter_name="Space Wolves") then intro+="  Also provided is Mjod, favored by the sons of Russ.";
        if (boozer_type=3) then intro+="  Many types of alcohol have also been provided in small tasting glasses.  Amasec, Dammassine, and half a dozen other kinds have all been provided.";        
    }
    
    scr_event_newlines(intro);
}

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>
if (fading=1) and (fade_alpha&lt;1) then fade_alpha+=0.025;
if (fading=-1) and (fade_alpha&gt;0) then fade_alpha-=0.025;
if (time_at&lt;time_min) then time_at+=0.25;
// if (time_at&gt;=time_max) and (stage!=10) then stage=10;
if (exit_fade&gt;=0) and (exit_fade&lt;30) then exit_fade+=1;

if (closing=true) and (fading=-1) and (fade_alpha&lt;=0){
    if (obj_controller.fest_type="Great Feast"){
        if (obj_controller.fest_feature1=1) then obj_controller.fest_feasts+=1;
        if (obj_controller.fest_feature2=1) then obj_controller.fest_boozes+=1;
        if (obj_controller.fest_feature3=1) then obj_controller.fest_drugses+=1;
    }
    
    var ide;ide=0;
    repeat(700){ide+=1;
        if (attend_corrupted[ide]=0) and (attend_id[ide]&gt;0){
            if (string_count("Chaos",obj_ini.artifact_tags[obj_controller.fest_display])&gt;0){
                obj_ini.chaos[attend_co[ide],attend_id[ide]]+=choose(1,2,3,4);
            }
            if (string_count("Daem",obj_ini.artifact_tags[obj_controller.fest_display])&gt;0){
                obj_ini.chaos[attend_co[ide],attend_id[ide]]+=choose(6,7,8,9);
            }
            attend_corrupted[ide]=1;
        }
    }
    
    obj_controller.fest_repeats-=1;
    if (obj_controller.fest_repeats&lt;=0){
        obj_controller.fest_scheduled=0;
        
        var p1,p2,p3;
        p1=obj_controller.fest_type;p3="";
        p2=obj_controller.fest_planet;
        
        if (p2&gt;0) then p3=string(obj_controller.fest_star)+" "+scr_roman(obj_controller.fest_wid);
        if (p2&lt;=0) then p3=+" the vessel '"+string(obj_ini.ship[obj_controller.fest_sid])+"'";
        
        scr_alert("green","event",string(p1)+" on "+string(p3)+" ends.",0,0);
        scr_event_log("green",string(p1)+" on "+string(p3)+" ends.");
    }
    
    with(obj_popup){if (number!=0) then obj_turn_end.alarm[1]=10;instance_destroy();}
    obj_controller.cooldown=30;
    instance_destroy();
}

if (stage&gt;=5) and (stage!=10){ticks+=1;
    if (ticks&gt;=next_display){
        ticks=0;ticked=1;
    }
}

if (ticked=1){// Select a random marine and have them perform an action
    if (lines_acted=18) and (exit_fade&lt;=-1) then exit_fade=0;

    if (lines_acted=18) and (part2!=""){
        if (part2="fish"){
            if (attendants&lt;=30) then textt=string(obj_img.player_army)+" Serfs ferry out several large, covered dishes, the scent of seafood filling the air.  Once they are set front and center the silver cloches are removed, revealing a banquet of exotic fish.  Raw rolls of meat with rice, pufferfish, and even a massive broadbill are contained within.";
            if (attendants&gt;30) then textt=string(obj_img.player_army)+" Serfs ferry out several large, covered dishes, the scent of seafood filling the air.  Once they are set front and center the silver cloches are removed, revealing a banquet of exotic fish.  Raw rolls of meat with rice, pufferfish, and several massive broadbill are contained within.";
        }
        if (part2="fruit"){
            textt=string(obj_img.player_army)+" Serfs ferry out several large, covered bowls.  Without further adeiu the lids are removed, revealing a large bounty of exotic fruits from across the galaxy.  Ploin, pineapple, mangos, strawberries, the fruit ranges from commonplace to nearly disappeared treasures.";
        }
        scr_event_newlines(textt);
        lines_acted+=1;time_min+=10;ticks=-120;
        ticked=0;stage=6;textt="";exit;
    }
    if (lines_acted=36) and (part3!=""){
        if (part3="lobster"){
            textt="A small army of "+string(obj_img.player_army)+" Serfs and servitors enter the room, carrying with them a truly massive silver plate.  Bore much like a palanquin, the massive dish is covered by an equally large and decorated cloche.  As the main course inches across the room it gathers quite the number of looks.  After struggling a bit the dish is set front and center in the room, the lid removed.  Contained within is a giant, boiled Deathcoleri from Zeriah II.  The once spikey carapace is now a healthily cooked red, the crustacean smelling absolutely delicious.";
        }
        scr_event_newlines(textt);
        lines_acted+=1;time_min+=10;ticks=-210;
        ticked=0;stage=7;textt="";exit;
    }

    
    var ide,good,dire,orig,dice1,dice2,dice3,dice4,txtt,rando,doso,activity;
    good=false;doso=false;activity="";
    dire=0;orig=0;rando=choose(1,2);
    dice1=floor(random(100))+1;
    dice2=floor(random(100))+1;
    dice3=floor(random(100))+1;
    
    repeat(20){
        if (good=false){
            good=true;ide=floor(random(attendants))+1;
            if (obj_ini.role[attend_co[ide],attend_id[ide]]=obj_img.faction_title[1]) then good=false;
            if (obj_ini.role[attend_co[ide],attend_id[ide]]="Master of Sanctity") then good=false;
            if (obj_ini.role[attend_co[ide],attend_id[ide]]="Master of the Apothecarion") then good=false;
            if (obj_ini.role[attend_co[ide],attend_id[ide]]="Forge Master") then good=false;
            if (obj_ini.role[attend_co[ide],attend_id[ide]]="Chief "+string(obj_ini.role[100,17])) then good=false;
        }
    }
    if (good=false) then good=true;
    
    
    // If this marine has already acted then look for a nearby marine that has yet to act
    if (attend_displayed[ide]&gt;0){
        if (attend_displayed[ide]&lt;=attendants/2) then dire=-1;
        if (attend_displayed[ide]&gt;attendants/2) then dire=1;
        orig=ide;
    }
    
    // Cycle downward
    if (dire=-1){good=false;
        var resp;resp=ide;
        
        repeat(resp){
            if (good=false){ide-=1;
                if (attend_displayed[ide]=0) then good=true;
            }
        }
        
        if (good=false) then dire=1;
        if (good=true) then dire=0;
    }
    
    // Cycle upward
    if (dire=1){good=false;
        var resp;resp=attendants;
        
        repeat(resp){
            if (good=false){ide+=1;
                if (attend_displayed[ide]=0) then good=true;
            }
        }
        
    }
    
    if (dire!=0) and (good=false){ide=orig;good=true;}
    
    if (attend_confused[ide]&gt;0){
        if (dice1&lt;=70){
            if (obj_controller.fest_type="Great Feast"){
                doso=false;activity="confused";
            }
        }
        if (dice1&gt;70) then doso=true;
    }
    if (attend_confused[ide]&lt;=0) and (activity="") then doso=true;
    
    if (doso=true){
        dice1=floor(random(100))+1;
        dice2=floor(random(100))+1;
        dice3=floor(random(100))+1;
        dice4=floor(random(100))+1;
        
        if (obj_controller.fest_type="Great Feast"){// Get chances of random crap when in a Great Feast
            var mod1,mod2,mod3,rep1,rep2,rep3;
            mod1=0;mod2=0;mod3=0;
            
            rep1=1;// attend_feasted[ide]+1;
            rep2=attend_drunk[ide]+1;
            rep3=attend_high[ide]+1;
            
            mod2=obj_ini.chaos[attend_co[ide],attend_id[ide]]/5;
            mod3=obj_ini.chaos[attend_co[ide],attend_id[ide]]/10;
            
            activity="talk";
            
            // show_message("roll needed for eating: &gt;="+string((((obj_controller.fest_feasts*30)-10)+mod1)/rep1)+", rolled:"+string(dice1));
            if (dice3&lt;=min(75,(((obj_controller.fest_drugses*10)-10)+mod3)/rep3)) and (obj_controller.fest_feature3&gt;0) then activity="drugs";
            if (dice2&lt;=min(75,(((obj_controller.fest_boozes*20)-10)+mod2)/rep2)) and (obj_controller.fest_feature2&gt;0) then activity="drink";
            if (dice1&lt;=min(75,(((obj_controller.fest_feasts*30))+mod1)/rep1)) and (obj_controller.fest_feature1&gt;0) then activity="eat";
            if ((global.chapter_name="Space Wolves") or (obj_ini.progenitor=3)) and (obj_controller.fest_feature2&gt;0) and (activity!="drink"){
                rando=choose(1,1,2);if (rando=2) then activity="drink";
            }
            rando=choose(1,2,3,4,5,6,7,8,9,10);
            if (rando&gt;=8) then activity="talk";
            
            if (obj_controller.fest_display&gt;0) and (dice4&lt;=15){
                activity="artifact";
            }
            
        }
    }
    
    if (activity="confused"){
        rando=choose(1,2,2,3);
        if (rando=1) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" is unsure of what to do.  He sits at the table silently, doing nothing.";
        if (rando=2) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" is confused.  He sits at the table and does nothing, wishing he were "+choose("killing xenos","praying","training","training","studying")+" instead.";
        
        // Special CONFUS for the various event types
        if (rando=3){
            if (obj_controller.fest_type="Great Feast") and (obj_controller.fest_feature1&gt;0) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" picks up silverwear to begin to feast, but then has second thoughts and puts them back down.";
            if (obj_controller.fest_type="Great Feast") and (obj_controller.fest_feature1&lt;=0) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" is unsure of what to do.  He sits at the table silently, doing nothing.";
        }
        
    }
    if (activity="eat"){
        var eater_type;eater_type=1;
        if (global.chapter_name="Space Wolves") or (obj_ini.progenitor=3) then eater_type=2;
        
        if (stage=5) and (eater_type=1){rando=choose(1,2,3);
            if (rando=1) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" digs into the food and begins to eat.";
            if (rando=2) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" begins to feast, eating the food slowly to enjoy the taste.";
            if (rando=3) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" grabs a portion of food for himself and begins to eat.";
        }
        if (stage=5) and (eater_type=2){rando=choose(1,2,3);
            if (rando=1) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" digs into the food and begins to eat.";
            if (rando=2) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" makes a show out of eating, consuming the food as loudly and dramaticaly as possible.";
            if (rando=3) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" begins to stuff their face full of food, hardly bothering to chew.";
        }
        if (stage=6){
            if (part2="fish"){rando=choose(1,2,3,3,3);
                if (rando=1) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" selects some of the sushi rolls and begins to pop them into his mouth.";
                if (rando=2) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" chooses a bit of each dish, chapter serfs setting up quite the variety of foods on his plate.";
                if (rando=3) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" grabs a portion of the broadbill and begins to eat it slowly, savoring the taste.";
            }
            if (part2="fruit"){rando=choose(1,2,3,3,3);
                if (rando=1) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" selects an assortment of fruit and begins to eat.";
                if (rando=2) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" finishes up the rest of his plate, and hails a serf to bring him some "+choose("pineapple","strawberries","grapes","apples","oranges","of each fruit")+".";
                if (rando=3) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" hails a chapter serf, and orders a variety of different fruits.  He then eats them slowly, enjoying the taste.";
            }
        }
        if (stage=7){
            if (part3="lobster"){
                rando=choose(1,2,2,3,3);
                if (eater_type=2) then rando=choose(1,2,2,3,3,4);
                if (rando=1) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" helps break open one of the massive legs of the Deathcoleri, then scoops out some of the meat within.";
                if (rando=2) and (eater_type=1) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" tears some of the tendrils free from the crustacean and begins to eat them.";
                if (rando=3) and (eater_type=1) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" rips some of the delectable meat free from the Deathcoleri's leg, and then eats it slowly, enjoying the treat.";
                if (rando=2) and (eater_type=2) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" begins to shovel Deathcoleri meat down his throat, boasting that he will eat more than anyone else.";
                if (rando=3) and (eater_type=2) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" rips tendrils free from the crustaceans face and begins to eat them, loudly.";
                if (rando=4) then text=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" wants the good parts.  He shoves his arm through the beast's shell and scoops out the innards, taking some for himself and sharing other bits.";
            }
        }
        
        attend_feasted[ide]+=1;
    }
    if (activity="drink"){
        var eater_type;eater_type=1;
        if (global.chapter_name="Space Wolves") or (obj_ini.progenitor=3) then eater_type=2;
        if (global.chapter_name="Blood Angels") or (obj_ini.progenitor=5) then eater_type=3;
        
        if (eater_type=1){
            if (attend_drunk[ide]&lt;=0) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" hails a serf and has "+choose("him","her")+" pour some Amasec.";
            if (attend_drunk[ide]&gt;0) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" sips at his Amasec, "+choose("enjoying the taste","judging the quality","savoring the treat")+".";
        }
        if (eater_type=2){
            // if (attend_drunk[ide]&lt;=0) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" hails a serf and has "+choose("him","her")+" bring him a tankard of Mjod.";
            // if (attend_drunk[ide]&gt;0){
                rando=choose(1,2,3);
                if (rando=1) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" pounds down Mjod, the concoction already beginning to inebriate the astartes.";
                if (rando=2) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" boasts that he will outdrink anyone, and then pounds down his tankard.  Nearby battlebrothers laugh and begin to meet his challenge.";
                if (rando=3) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" begins to drink down Mjod, a large frothing glass of the substance in each hand.  He alternates between the two.";
            // }
        }
        if (eater_type=3){
            if (attend_drunk[ide]&lt;=0) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" hails a serf and has "+choose("him","her")+" pour him a glass of "+choose("red wine","Amasec","Dammassine")+".";
            if (attend_drunk[ide]&gt;0) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" sips at his drink slowly, "+choose("enjoying the taste","judging the quality","analyzing the components")+".";
        }
        
        attend_drunk[ide]+=1;
    }
    if (activity="drugs"){
        attend_high[ide]+=1;
        obj_ini.chaos[attend_co[ide],attend_id[ide]]=min(100,obj_ini.chaos[attend_co[ide],attend_id[ide]]+10);
        if (attend_high[ide]&lt;=1) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" snorts up a line of powder through a straw.  Why not?";
        if (attend_high[ide]&gt;1) then textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" snorts another line of powder.";
    }
    
    
    // show_message("activity:"+string(activity)+", text:"+string(textt));
    
    
    if (activity="talk"){
        textt=scr_event_gossip(ide);
    }
    
    if (activity="artifact"){
        var spesh,woa;spesh="";
        woa=string(obj_ini.artifact[obj_controller.fest_display]);
        
        if (string_count("GOAT",obj_ini.artifact_tags[obj_controller.fest_display])&gt;0) then spesh="nerves";
        if (string_count("CHE",obj_ini.artifact_tags[obj_controller.fest_display])&gt;0) then spesh="nerves";
        if (string_count("SPE",obj_ini.artifact_tags[obj_controller.fest_display])&gt;0) then spesh="nerves";
        if (string_count("THI",obj_ini.artifact_tags[obj_controller.fest_display])&gt;0) then spesh="nerves";
        if (string_count("TEN",obj_ini.artifact_tags[obj_controller.fest_display])&gt;0) then spesh="nerves";
        if (string_count("JUM",obj_ini.artifact_tags[obj_controller.fest_display])&gt;0) then spesh="nerves";
        if (string_count("PRE",obj_ini.artifact_tags[obj_controller.fest_display])&gt;0) then spesh="nerves";
        if (string_count("DYI",obj_ini.artifact_tags[obj_controller.fest_display])&gt;0) then spesh="offend";        
        if (spesh="") and (string_count("MNR",obj_ini.artifact_tags[obj_controller.fest_display])&gt;0) then spesh="minor";
        
        
        textt=string(obj_ini.role[attend_co[ide],attend_id[ide]])+" "+string(obj_ini.name[attend_co[ide],attend_id[ide]])+" ";
        
        if (spesh=""){rando=choose(1,2,3,4,5);
            if (rando=1) then textt+="inspects the "+string(woa)+" on display, admiring the craftsmanship.";
            if (rando=2) then textt+="gazes at the "+string(woa)+" Artifact, wondering of its origins.";
            if (rando=3) then textt+="seems enamored with the "+string(woa)+" on display.";
            if (rando=4) then textt+="asks one of his nearby battle brothers what they know of the "+string(woa)+" on display.";
            if (rando=5) then textt+="stares at the "+string(woa)+", not quite sure what to make of it.";
        }
        if (spesh="nerves") or (spesh="offend"){rando=choose(1,2,3);
            if (rando=1) then textt+="is unsettled by the "+string(woa)+" Artifact.";
            if (rando=2) then textt+="stares at the "+string(woa)+", not quite sure what to make of it.";
            if (rando=3) then textt+="has no idea why anyone would choose to make the "+string(woa)+" on display.";
        }
        if (spesh="minor"){rando=choose(1,2,3);
            if (rando=1) then textt+="is unimpressed by the "+string(woa)+" Artifact.";
            if (rando=2) then textt+="has seen finer "+string(woa)+" than the one on display.";
            if (rando=3) then textt+="inspects the "+string(woa)+" on display.  He has seen more impressive ones before.";
        }
        
        
        if (attend_corrupted[ide]=0){
            if (string_count("Chaos",obj_ini.artifact_tags[obj_controller.fest_display])&gt;0){
                obj_ini.chaos[attend_co[ide],attend_id[ide]]+=choose(1,2,3,4);
            }
            if (string_count("Daem",obj_ini.artifact_tags[obj_controller.fest_display])&gt;0){
                obj_ini.chaos[attend_co[ide],attend_id[ide]]+=choose(6,7,8,9);
            }
            attend_corrupted[ide]=1;
        }
        
        
        /*
        
        
        
        if (t1="Weapon"){
            // gold, glowing, underslung bolter, underslung flamer
            t5=choose("GLD","GLO","UBL","UFL");
            // Runes, scope, adamantium, void
            t4=choose("RUN","SCO","ADA","VOI");
            if ((t2="Power Sword") or (t2="Power Axe") or (t2="Power Spear")) and (t4="SCO") then t4="CHB";// chainblade
            if ((t2="Power Fist") or (t2="Power Claw")) and (t4="SCO") then t4="DUB";// doubled up
            if (t2="Relic Blade") and (t4="SCO") then t4="UFL";// underslung flamer
        }
        if (t1="Armor"){
            // golden filigree, glowing optics, purity seals
            t5=choose("GLD","GLO","PUR");
            // articulated plates, spikes, runes, drake scales
            t4=choose("ART","SPI","RUN","DRA");
        }
        if (t1="Gear"){
            // supreme construction, adamantium, gold
            t4=choose("SUP","ADA","GOLD");// bur = ever burning
            if (t2="Rosarius") then t5=choose("GLD","GLO","BIG","BUR");
            if (t2="Bionics") then t5=choose("GLD","GLO","RUN","SOO");// Soothing appearance
            if (t2="Psychic Hood") then t5=choose("FIN","GLD","BUR","MASK");// fine cloth, gold, ever burning, mask
            if (t2="Jump Pack") then t5=choose("SPI","SKRE","WHI","SIL");// spikes, screaming, white flame, silent
            if (t2="Servo Arms") then t5=choose("GLD","TEN","GOR","SOO");// gold, tentacles, gorilla build, soothing appearance
        }
        if (t1="Device") and (t2!="Robot"){
            t4=choose("GOLD","CRU","GLO","ADA");// skulls, falling angel, thin, tentacle, mindfuck
            if (t2!="Statue") then t5=choose("SKU","FAL","THI","TEN","MIN");
            // goat, speechless, dying angel, jumping into magma, cheshire grunx
            if (t2="Statue") then t5=choose("GOAT","SPE","DYI","JUM","CHE");
            // Gold, glowing, preserved flesh, adamantium
            if (t2="Tome") then t4=choose("GOLD","GLO","PRE","ADA","SAL","BUR");
            if (t4="PRE") and (t3="") then t3=choose("","Chaos","Daemonic");
        }
        if (t1="Device") and (t2="Robot"){// human/robutt/shivarah
            t4=choose("HU","RO","SHI");
            t5=choose("ADA","JAD","BRO","RUNE");
        }
        
        
        if (string_count("Chaos",obj_ini.artifact_tags[obj_controller.fest_display])&gt;0) then spesh="chaos";
        if (string_count("Daem",obj_ini.artifact_tags[obj_controller.fest_display])&gt;0) then spesh="daemonic";
        
        */
    }
    
    
    if (textt!=""){
        scr_event_newlines(textt);textt="";
        attend_confused[ide]-=1;
        attend_displayed[ide]+=1;
        lines_acted+=1;time_min+=10;liness+=1;
        
        if (time_min&gt;time_max) then time_min=time_max;
    }
    
    ticked=0;
}


if (liness&gt;(attendants/2)){
    var i;i=-1;repeat(1501){i+=1;attend_displayed[i]=0;}
    liness=0;
}

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>
var xx,yy,ii;
xx=view_xview[0]+317;
yy=view_yview[0]+144;
ii=0;

draw_set_alpha(fade_alpha);

// BG
draw_sprite(spr_popup_event,0,xx,yy);
draw_sprite(spr_popup_event,1,xx,yy);

// Draw avatars here
var x5,y5;
x5=xx+15-120;
y5=yy+482;

ii=0;


draw_set_color(0);
draw_set_font(fnt_40k_30b);
draw_set_halign(fa_center);
// draw_text(view_xview[0]+800,view_yview[0]+165,string(obj_controller.fest_type)+"#"+string(obj_controller.fest_display)+"] "+string(obj_controller.fest_display_tags));
draw_text(view_xview[0]+800,view_yview[0]+165,string(obj_controller.fest_type));

if (avatars&gt;0){
    if( shader_is_compiled(sReplaceColor)){
        shader_set(sReplaceColor);
        
        shader_set_uniform_f(colour_to_find1, sourceR1,sourceG1,sourceB1 );       
        shader_set_uniform_f(colour_to_set1, targetR1,targetG1,targetB1 );
        shader_set_uniform_f(colour_to_find2, sourceR2,sourceG2,sourceB2 );       
        shader_set_uniform_f(colour_to_set2, targetR2,targetG2,targetB2 );
        shader_set_uniform_f(colour_to_find3, sourceR3,sourceG3,sourceB3 );       
        shader_set_uniform_f(colour_to_set3, targetR3,targetG3,targetB3 );
        shader_set_uniform_f(colour_to_find4, sourceR4,sourceG4,sourceB4 );       
        shader_set_uniform_f(colour_to_set4, targetR4,targetG4,targetB4 );
        shader_set_uniform_f(colour_to_find5, sourceR5,sourceG5,sourceB5 );
        shader_set_uniform_f(colour_to_set5, targetR5,targetG5,targetB5 );
        shader_set_uniform_f(colour_to_find6, sourceR6,sourceG6,sourceB6 );
        shader_set_uniform_f(colour_to_set6, targetR6,targetG6,targetB6 );
        shader_set_uniform_f(colour_to_find7, sourceR7,sourceG7,sourceB7 );
        shader_set_uniform_f(colour_to_set7, targetR7,targetG7,targetB7 );
    }
    
    draw_set_font(fnt_40k_14b);
    draw_set_halign(fa_center);
    draw_set_color(c_black);
    
    repeat(8){ii+=1;x5+=120;
        if (avatar_name[ii]!=""){
            // draw_sprite(spr_popup_event_avatar,avatar_image[ii],x5,y5);
            scr_image("event",avatar_image[ii],x5,y5,97,95);
            draw_text_transformed(x5+47,y5+99,string(avatar_name[ii]),0.75,1,0);
            // draw_text(x5+45,y5+100,string(avatar_name[ii])+"#"+string(avatar_rank[ii]));
        }
    }
    
    shader_reset();
    
}


draw_set_color(c_black);draw_rectangle(xx+25,yy+102,xx+940,yy+106,1);
draw_set_color(c_blue);draw_rectangle(xx+25,yy+102,xx+25+((time_at/time_max)*915),yy+106,0);

draw_set_halign(fa_left);draw_set_font(fnt_40k_14);


if (exit_fade&gt;=0){
    var ealpha;ealpha=exit_fade/30;
    draw_set_alpha(min(fade_alpha,ealpha));
    
    if (exit_fade&lt;30) then draw_sprite(spr_help_exit,0,view_xview[0]+1238,view_yview[0]+200);
    if (exit_fade&gt;=30){
        draw_set_alpha(min(fade_alpha,1));
        if (scr_hit(view_xview[0]+1238,view_yview[0]+200,view_xview[0]+1271,view_yview[0]+233)=false) then draw_sprite(spr_help_exit,0,view_xview[0]+1238,view_yview[0]+200);
        if (scr_hit(view_xview[0]+1238,view_yview[0]+200,view_xview[0]+1271,view_yview[0]+233)=true){
            draw_sprite(spr_help_exit,1,view_xview[0]+1238,view_yview[0]+200);
            if (obj_controller.mouse_left=1) and (closing=false){
                closing=true;fading=-1;
            }
        }
    }
    draw_set_alpha(1);
}


draw_set_color(c_gray);
draw_set_alpha(fade_alpha);
ii=0;y5=yy+120-21;
repeat(17){y5+=21;ii+=1;
    draw_text_ext(xx+25,y5,string(line[ii]),-1,916);
}
draw_set_alpha(1);

</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
